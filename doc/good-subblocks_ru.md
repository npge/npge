# NPG-explorer

## Алгоритм обнаружения качественных подблоков в блоке

### Параметры

 * `min_length` - минимальная длина
 * `min_identity` - минимальная идентичность

Данные опции используются в алгоритме построения пангенома.
Значение `min_length` - минимальная длина качественного блока,
входящего в пангеном. Стандартное значение `min_length`
составляет 100 нуклеотидов. Значение `min_identity` - это
минимальная доля идентичных позиций в выравнивании блока
пангенома. Стандартное значение составляет 90%.

### Входы

Блок, не удовлетворяющий критериям.

### Выходы

Список блоков, удовлетворяющих критериям (качественных
подблоков).

### Алгоритм

1. Для каждой колонки блока определить, является ли она
   качественной. Колонка считается качественной, если она
   представлена одинаковой буквой в каждой последовательности
   и эта буква одна из "A", "T", "G", "C".

2. Перебрать все срезы длины `min_length` в блоке. Если
   идентичность среза больше или равна `min_identity`, то срез
   считается качественным.

3. Сгруппировать последовательные качественные срезы в более
   длинные качественные срезы.
   Если длинный качественный срез начинается или заканчивается
   некачественными колонками, то исключить эти колонки.

4. Создать множество качественных блоков (пустое).

5. Найти хороший срез максимальной длины.
   Если его длина больше или равна `min_length`,
   превратить его в блок и добавить этот блок в множество
   качественных блоков.
   Иначе СТОП алгоритма.

6. Исключить позиции, входящие в качественный блок,
   из всех оставшихся блоков.
   Если длинный качественный срез начинается или заканчивается
   некачественными колонками, то исключить эти колонки.

7. Перейти на шаг 5.

Шаг 2 может быть пройден на время `O(N)`, где N - длина блока.
Для каждой колонки считать число качественных колонок A,
расположенных слева от этой колонки. Это можно сделать с помощью
динамического программирования. Для получения числа хороших
колонок в произвольном блоке нужно вычислить `a[stop]-a[start]`.

Выбор качественных блоков максимальной длины (шаг 5) может
быть оптимизирован за счёт бинарной кучи или аналогичной
структуры данных.

### Пример

Параметры:
 - `min_length` = 3
 - `min_identity` = 50%

Вход:
```
TAATGC
TATT-C
```

Шаги алгоритма:

```
TAATGC
TATT-C

++-+-+   Найти хорошие и плохие колонки

+++
 +++     Найти хорошие и плохие подблоки
  ---    min_identity = 50%
   +++

++++     Объединить хорошие срезы, создать подблоки
```
