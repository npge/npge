${PROJECT_BINARY_DIR}/src/test/rand_seq 100000 s1 > test.fasta &&
sleep 1
${PROJECT_BINARY_DIR}/src/test/rand_seq 100000 s2 >> test.fasta &&
echo "GCCGCGCATACGTCTGTCAGAGTTTGATCCATGCCTTGTGCAAAATGTAGCA" >> test.fasta &&
echo "GCCGCGCATACGTCTGTCAGAGTTTGATCCATGCCTTGTGCAAAATGTAGCA" >> test.fasta &&
${PROJECT_BINARY_DIR}/src/tool/npge \
    In,AnchorFinder,OutputPipe \
    --in-blocks test.fasta --anchor-size=15 \
    --workers=2 --skip-rest=1 > repeats.txt &&
sed ':a;N;$!ba;s/\n//g' test.fasta > for_grep.txt &&
rev test.fasta | tac | tr ATGC TACG | sed ':a;N;$!ba;s/\n//g' > complement.txt
for i in `grep -v '>' repeats.txt`; do
    if [ `grep -o $i for_grep.txt complement.txt | wc -l` -lt 2 ]; then
        # fragments of block can be overlapping
        if [ `cat for_grep.txt complement.txt | perl -e '$v = do { local $/; <STDIN> }; @v = $v =~ /(?=('$i'))/g;print join("\n", @v)."\n";' | wc -l` -lt 2 ]; then
            echo Anchor $i not found in sequence
            exit 1;
        fi
    fi
done
if [ `grep -c '>' repeats.txt` -eq 0 ]; then
    echo No anchors found
    exit 2;
fi

